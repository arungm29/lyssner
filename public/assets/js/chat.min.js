(function(e,a){var d=a.getElementById("vent");var c=a.getElementById("listen");d.onclick=function(){b(true)};c.onclick=function(){b(false)};function b(u){var l="";var t=false;var o;var r=io.connect(window.location.host,{forceNew:true});var v=io(window.location.host+"/stats");var k=0;var g=false;var q=false;var m={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","\n":"<br>"};var f=(function(){var y,w,x={hidden:"visibilitychange",webkitHidden:"webkitvisibilitychange",mozHidden:"mozvisibilitychange",msHidden:"msvisibilitychange"};for(y in x){if(y in a){w=x[y];break}}return function(z){if(z){a.addEventListener(w,z)}return !a[y]}})();e("article").remove();e(".stats").css("display","block");e('<div class="logwrapper" style="top: 81px;"><div class="logbox"><div id="box" style="position: relative; min-height: 100%;"><div class="logitem"><p class="statuslog">Connecting...</p></div></div></div></div><div class="controlwrapper"><table class="controltable" cellpadding="0" cellspacing="0" border="0"><tbody><tr><td class="disconnectbtncell"><div class="disconnectbtnwrapper newbtn"><button id="disconnectbtn">Disconnect<div class="btnkbshortcut">Esc</div></button></div></td><td class="chatmsgcell"><div class="chatmsgwrapper"><textarea id="chatmsg" cols="80" rows="3" disabled></textarea></div></td><td class="sendbthcell"><div class="sendbtnwrapper"><button id="sendbtn" disabled>Send<div class="btnkbshortcut">Enter</div></button></div></td></tr></tbody></table></div>').insertAfter(".l-header");e(".l-site-header").css("width","auto");var n=a.createElement("audio");n.setAttribute("src","assets/media/notif.mp3");n.setAttribute("preload","auto");i();v.on("updatechatting",function(w){a.getElementById("chatting").innerHTML=w.count});v.on("updateventer",function(w){a.getElementById("ventcount").innerHTML=w.count});v.on("updatelistener",function(w){a.getElementById("listencount").innerHTML=w.count});f(function(){if(f()&&k!==0){k=0;a.title="Lyssner | Vent your heart out"}});a.getElementById("sendbtn").onclick=function(){if(!(e("#chatmsg").is(":disabled"))){e("#chatmsg").focus();t=false;clearTimeout(o);l=a.getElementById("chatmsg").value;if(!(e("#chatmsg").val().match(/^\s*$/))){p(l)}}};a.getElementById("disconnectbtn").onclick=s;e(a).keyup(function(w){if(w.keyCode==27){s()}});e("#chatmsg").keypress(function(w){if(w.keyCode!=13){if(t===false){t=true;r.emit("typing",{message:"Stranger is typing"});o=setTimeout(h,3000)}else{clearTimeout(o);o=setTimeout(h,3000)}}if(e(this).val().match(/^\s*$/)&&w.keyCode==13&&!w.shiftKey){w.preventDefault()}else{if(w.keyCode==13&&!w.shiftKey){t=false;clearTimeout(o);w.preventDefault();l=a.getElementById("chatmsg").value;p(l);a.getElementById("chatmsg").value=""}}});e("#chatmsg").keyup(function(){if(e(this).val()===""){r.emit("clearedtextfield");t=false}});function i(){r.emit("identify",{chattype:u});r.on("entrance",function(w){e(".logitem").replaceWith('<div class="logitem"><p class="statuslog">'+w.message+"</p></div>")});r.on("foundpartner",function(w){e(".logitem").replaceWith('<div class="logitem"><p class="statuslog">'+w.message+"</p></div>");window.onbeforeunload=function(){return"A chat is still in progress."};a.getElementById("chatmsg").disabled=false;a.getElementById("sendbtn").disabled=false;e("#chatmsg").focus()});r.on("exit",function(w){window.onbeforeunload=null;a.getElementById("box").innerHTML+='<div class="logitem"><p class="statuslog">'+w.message+"</p></div>";e(".logbox").scrollTop(e(".logbox")[0].scrollHeight);r.disconnect();a.getElementById("chatmsg").disabled=true;a.getElementById("sendbtn").disabled=true;a.getElementById("disconnectbtn").innerHTML='New Chat<div class="btnkbshortcut">Esc</div>';q=true;g=true});r.on("is typing",function(w){if(a.getElementById("typing")){e("#typing").replaceWith('<div class="logitem" id="typing"><p class="statuslog">'+w.message+"...</p></div>");e(".logbox").scrollTop(e(".logbox")[0].scrollHeight)}else{a.getElementById("box").innerHTML+='<div class="logitem" id="typing"><p class="statuslog">'+w.message+"...</p></div>";e(".logbox").scrollTop(e(".logbox")[0].scrollHeight)}});r.on("clearedtextfield",function(){e("#typing").remove();clearTimeout(o)});r.on("stopped",function(w){e("#typing").replaceWith('<div class="logitem" id="typing"><p class="statuslog">'+w.message+"</p></div>");e(".logbox").scrollTop(e(".logbox")[0].scrollHeight)});r.on("chat",function(w){e("#typing").remove();a.getElementById("box").innerHTML+='<div class="logitem"><p class="strangermsg"><strong class="msgsource">Stranger:</strong> <span>'+w.message+"</span></p></div>";e(".logbox").scrollTop(e(".logbox")[0].scrollHeight);if(!f()){n.play();k++;a.title="("+k+") Lyssner | Vent your heart out"}})}function h(){t=false;r.emit("stoppedtyping",{message:"Stranger has entered text."})}function p(w){w=w.replace(/^\s+|\s+$/g,"");var y=j(w);a.getElementById("chatmsg").value="";var x=a.createElement("div");x.className="logitem";x.innerHTML='<p class="youmsg"><strong class="msgsource">You:</strong> <span>'+y+"</span></p>";if(a.getElementById("typing")){a.getElementById("box").insertBefore(x,a.getElementById("typing"));e(".logbox").scrollTop(e(".logbox")[0].scrollHeight)}else{a.getElementById("box").innerHTML+='<div class="logitem"><p class="youmsg"><strong class="msgsource">You:</strong> <span>'+y+"</span></p></div>";e(".logbox").scrollTop(e(".logbox")[0].scrollHeight)}r.emit("chat",{message:y})}function s(){if(!g){a.getElementById("disconnectbtn").innerHTML='Sure?<div class="btnkbshortcut">Esc</div>';g=true}else{if(g&&!q){a.getElementById("box").innerHTML+='<div class="logitem"><p class="statuslog">You have disconnected.</p></div>';r.disconnect();a.getElementById("disconnectbtn").innerHTML='New Chat<div class="btnkbshortcut">Esc</div>';e(".logbox").scrollTop(e(".logbox")[0].scrollHeight);window.onbeforeunload=null;a.getElementById("chatmsg").disabled=true;a.getElementById("sendbtn").disabled=true;q=true}else{g=false;q=false;a.getElementById("chatmsg").value="";a.getElementById("disconnectbtn").innerHTML='Disconnect<div class="btnkbshortcut">Esc</div>';a.getElementById("box").innerHTML='<div class="logitem"><p class="statuslog">Connecting...</p></div>';r=io.connect({forceNew:true});i()}}}function j(w){return String(w).replace(/[&<>"'\/]|[\n]/g,function(x){return m[x]})}}}(window.jQuery,document));